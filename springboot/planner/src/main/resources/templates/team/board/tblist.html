<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
	<meta charset="UTF-8"/>
	<title th:text="${teamDTO.team_name}+' 게시판'"></title>
</head>
<body>

<th:block th:if="${tbCountAll} == 0">
<h2>게시판에 작성된 글이 없습니다.</h2>
</th:block>

<th:block th:if="${tbCountAll} > 0" th:with="params=|team_id=${team_id}&ca=${ca}&ps=${ps}&so=${so}&search=${search}|">
<h3 th:text="${teamDTO.team_name}+' 게시판'" th:onclick="window.location='list?team_id=[[${team_id}]]'"></h3>
<p>
	총 게시글 : <span th:text="${tbCountAll}"></span> <br>
	검색된 게시글 : <span th:text="${tbCount}"></span>
</p>

<div>
	페이지 당 게시글 : 
	<select id="ps">
		<option value="15" th:selected="${ps} == 15">15
		<option value="30" th:selected="${ps} == 30">30
		<option value="50" th:selected="${ps} == 50">50
	</select>
</div>

<div>
	카테고리 : 
	<select id="ca">
		<option value="전체" th:selected="${ca} == '전체'">전체
		<option value="공지" th:selected="${ca} == '공지'">공지
		<option value="일반" th:selected="${ca} == '일반'">일반
		<option value="질문" th:selected="${ca} == '질문'">질문
	</select>
</div>

<form action="/team/board/list" method="get" id="listForm" onsubmit="return searchCheck()">
	<input type="hidden" name="team_id" th:value="${team_id}">
	<input type="hidden" name="ps" th:value="${ps}">
	<input type="hidden" name="ca" th:value="${ca}">
	<input type="hidden" name="pageNum" th:value="${pageNum}">
	<select id="so" name="so">
		<option value="T" th:selected="${so} == 'T'">제목
		<option value="C" th:selected="${so} == 'C'">내용
		<option value="TC" th:selected="${so} == 'TC'">제목+내용
		<option value="W" th:selected="${so} == 'W'">글쓴이
	</select>
	<input type="text" th:value="${search}" name="search" id="search" placeholder="검색어">
	<button type="submit" id="search_btn">검색</button>
</form>

<h3 th:if="${tbCount} == 0">검색된 게시글이 없습니다.</h3>
<table th:if="${tbCount} > 0" th:with="today=${#temporals.createToday()}">
	<tr>
		<th>카테고리
		<th>글번호
		<th>제목
		<th>작성자
		<th>작성일
	</tr>
	<tr th:if="${list} != null" th:each="dto : ${list}">
		<td th:text="${dto.tb_category}">
		<td th:text="${dto.team_board_id}">
		<td><a th:text="${dto.tb_title}" 
			th:href="@{|/team/board/view?${params}&pageNum=${pageNum}&tb_id=${dto.team_board_id}|}"></a>
		<td th:text="${dto.tm_nickname}">
		<td th:if="${dto.tb_reg.toLocalDate().isEqual(today)}" th:text="${#temporals.format(dto.tb_reg, 'HH:mm')}">
		<td th:unless="${dto.tb_reg.toLocalDate().isEqual(today)}" th:text="${#temporals.format(dto.tb_reg, 'MM-dd')}">
	</tr>
</table>

<div th:if="${tbCount} > 0">
	<a th:if="${pageNum} > ${pageBlock}" th:href="@{|/team/board/list?${params}&pageNum=${startPage - 1}|}">이전</a>
	<th:block th:each="pnum : ${#numbers.sequence(startPage, endPage)}">
		<a th:if="${pnum != pageNum}" th:href="@{|/team/board/list?${params}&pageNum=${pnum}|}" th:text="${pnum}"></a>
		<b th:if="${pnum == pageNum}" th:href="@{/}" th:text="${pageNum}"></b>
	</th:block>
	<a th:if="${endPage} < ${totalPage}" th:href="@{|/team/board/list?${params}&pageNum=${startPage + pageBlock}|}">다음</a>
</div>

<script>
	const listForm = document.getElementById("listForm")
	const ps = document.getElementById("ps")
	const ca = document.getElementById("ca")
	
	ps.onchange = function(){
		let ops = listForm.ps.value;
		let nps = ps.options[ps.selectedIndex].value;
		let pn = listForm.pageNum.value;
		listForm.ps.value = nps;
		listForm.pageNum.value = Math.ceil((ops*(pn-1)+1)/nps); 
		listForm.submit();
	}
	ca.onchange = function(){
		listForm.ca.value = ca.options[ca.selectedIndex].value;
		listForm.pageNum.value = 1;
		listForm.submit();
	}
	function searchCheck(){
		let search = listForm.search.value.trim();
		if(search.length != 1){
			listForm.pageNum.value = 1;
			return true;
		}else{
			alert("검색어는 2글자 이상 입력해주세요.");
			return false;
		}
	}
</script>
</th:block>
</body>
</html>